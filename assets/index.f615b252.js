import{u as Se,R as ze,r as x,A as Ae,s as Oe,d as W,k as U,j as d,H as Fe,e as o,L as ne,v as ce,w as k,S as De,Q as O,B as Ee,M as ie}from"./index.d2c701b9.js";import{B as Me}from"./Button.e6363547.js";import{Q as je}from"./QuantityController.0a7344e6.js";import{P as Be}from"./PurchaseSkeleton.679c9b82.js";import"./InputNumber.4e660125.js";var Ie=Object.defineProperty,se=Object.getOwnPropertySymbols,Re=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable,oe=(e,t,r)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,qe=(e,t)=>{for(var r in t||(t={}))Re.call(t,r)&&oe(e,r,t[r]);if(se)for(var r of se(t))Te.call(t,r)&&oe(e,r,t[r]);return e},me=Symbol.for("immer-nothing"),ae=Symbol.for("immer-draftable"),h=Symbol.for("immer-state");function p(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var N=Object.getPrototypeOf;function w(e){return!!e&&!!e[h]}function P(e){var t;return e?he(e)||Array.isArray(e)||!!e[ae]||!!((t=e.constructor)!=null&&t[ae])||B(e)||I(e):!1}var Qe=Object.prototype.constructor.toString();function he(e){if(!e||typeof e!="object")return!1;const t=N(e);if(t===null)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Qe}function D(e,t){j(e)===0?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,n)=>t(n,r,e))}function j(e){const t=e[h];return t?t.type_:Array.isArray(e)?1:B(e)?2:I(e)?3:0}function L(e,t){return j(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function _e(e,t,r){const n=j(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Ke(e,t){return e===t?e!==0||1/e===1/t:e!==e&&t!==t}function B(e){return e instanceof Map}function I(e){return e instanceof Set}function b(e){return e.copy_||e.base_}function X(e,t){if(B(e))return new Map(e);if(I(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&he(e))return N(e)?qe({},e):Object.assign(Object.create(null),e);const r=Object.getOwnPropertyDescriptors(e);delete r[h];let n=Reflect.ownKeys(r);for(let c=0;c<n.length;c++){const a=n[c],u=r[a];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(r[a]={configurable:!0,writable:!0,enumerable:u.enumerable,value:e[a]})}return Object.create(N(e),r)}function V(e,t=!1){return R(e)||w(e)||!P(e)||(j(e)>1&&(e.set=e.add=e.clear=e.delete=We),Object.freeze(e),t&&Object.entries(e).forEach(([r,n])=>V(n,!0))),e}function We(){p(2)}function R(e){return Object.isFrozen(e)}var Ue={};function v(e){const t=Ue[e];return t||p(0,e),t}var C;function pe(){return C}function He(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function le(e,t){t&&(v("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function $(e){J(e),e.drafts_.forEach(Ge),e.drafts_=null}function J(e){e===C&&(C=e.parent_)}function de(e){return C=He(C,e)}function Ge(e){const t=e[h];t.type_===0||t.type_===1?t.revoke_():t.revoked_=!0}function ue(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return e!==void 0&&e!==r?(r[h].modified_&&($(t),p(4)),P(e)&&(e=E(t,e),t.parent_||M(t,e)),t.patches_&&v("Patches").generateReplacementPatches_(r[h].base_,e,t.patches_,t.inversePatches_)):e=E(t,r,[]),$(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==me?e:void 0}function E(e,t,r){if(R(t))return t;const n=t[h];if(!n)return D(t,(c,a)=>fe(e,n,t,c,a,r)),t;if(n.scope_!==e)return t;if(!n.modified_)return M(e,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const c=n.copy_;let a=c,u=!1;n.type_===3&&(a=new Set(c),c.clear(),u=!0),D(a,(f,y)=>fe(e,n,c,f,y,r,u)),M(e,c,!1),r&&e.patches_&&v("Patches").generatePatches_(n,r,e.patches_,e.inversePatches_)}return n.copy_}function fe(e,t,r,n,c,a,u){if(w(c)){const f=a&&t&&t.type_!==3&&!L(t.assigned_,n)?a.concat(n):void 0,y=E(e,c,f);if(_e(r,n,y),w(y))e.canAutoFreeze_=!1;else return}else u&&r.add(c);if(P(c)&&!R(c)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;E(e,c),(!t||!t.scope_.parent_)&&typeof n!="symbol"&&Object.prototype.propertyIsEnumerable.call(r,n)&&M(e,c)}}function M(e,t,r=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&V(t,r)}function Le(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:pe(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let c=n,a=ee;r&&(c=[n],a=S);const{revoke:u,proxy:f}=Proxy.revocable(c,a);return n.draft_=f,n.revoke_=u,f}var ee={get(e,t){if(t===h)return e;const r=b(e);if(!L(r,t))return Xe(e,r,t);const n=r[t];return e.finalized_||!P(n)?n:n===H(e.base_,t)?(G(e),e.copy_[t]=Z(n,e)):n},has(e,t){return t in b(e)},ownKeys(e){return Reflect.ownKeys(b(e))},set(e,t,r){const n=ye(b(e),t);if(n!=null&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const c=H(b(e),t),a=c==null?void 0:c[h];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(Ke(r,c)&&(r!==void 0||L(e.base_,t)))return!0;G(e),Y(e)}return e.copy_[t]===r&&(r!==void 0||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty(e,t){return H(e.base_,t)!==void 0||t in e.base_?(e.assigned_[t]=!1,G(e),Y(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0},getOwnPropertyDescriptor(e,t){const r=b(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.type_!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty(){p(11)},getPrototypeOf(e){return N(e.base_)},setPrototypeOf(){p(12)}},S={};D(ee,(e,t)=>{S[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}});S.deleteProperty=function(e,t){return S.set.call(this,e,t,void 0)};S.set=function(e,t,r){return ee.set.call(this,e[0],t,r,e[0])};function H(e,t){const r=e[h];return(r?b(r):e)[t]}function Xe(e,t,r){var n;const c=ye(t,r);return c?"value"in c?c.value:(n=c.get)==null?void 0:n.call(e.draft_):void 0}function ye(e,t){if(!(t in e))return;let r=N(e);for(;r;){const n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=N(r)}}function Y(e){e.modified_||(e.modified_=!0,e.parent_&&Y(e.parent_))}function G(e){e.copy_||(e.copy_=X(e.base_,e.scope_.immer_.useStrictShallowCopy_))}var $e=class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,r,n)=>{if(typeof t=="function"&&typeof r!="function"){const a=r;r=t;const u=this;return function(y=a,...z){return u.produce(y,A=>r.call(this,A,...z))}}typeof r!="function"&&p(6),n!==void 0&&typeof n!="function"&&p(7);let c;if(P(t)){const a=de(this),u=Z(t,void 0);let f=!0;try{c=r(u),f=!1}finally{f?$(a):J(a)}return le(a,n),ue(c,a)}else if(!t||typeof t!="object"){if(c=r(t),c===void 0&&(c=t),c===me&&(c=void 0),this.autoFreeze_&&V(c,!0),n){const a=[],u=[];v("Patches").generateReplacementPatches_(t,c,a,u),n(a,u)}return c}else p(1,t)},this.produceWithPatches=(t,r)=>{if(typeof t=="function")return(u,...f)=>this.produceWithPatches(u,y=>t(y,...f));let n,c;return[this.produce(t,r,(u,f)=>{n=u,c=f}),n,c]},typeof(e==null?void 0:e.autoFreeze)=="boolean"&&this.setAutoFreeze(e.autoFreeze),typeof(e==null?void 0:e.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){P(e)||p(8),w(e)&&(e=Je(e));const t=de(this),r=Z(e,void 0);return r[h].isManual_=!0,J(t),r}finishDraft(e,t){const r=e&&e[h];(!r||!r.isManual_)&&p(9);const{scope_:n}=r;return le(n,t),ue(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const c=t[r];if(c.path.length===0&&c.op==="replace"){e=c.value;break}}r>-1&&(t=t.slice(r+1));const n=v("Patches").applyPatches_;return w(e)?n(e,t):this.produce(e,c=>n(c,t))}};function Z(e,t){const r=B(e)?v("MapSet").proxyMap_(e,t):I(e)?v("MapSet").proxySet_(e,t):Le(e,t);return(t?t.scope_:pe()).drafts_.push(r),r}function Je(e){return w(e)||p(10,e),ge(e)}function ge(e){if(!P(e)||R(e))return e;const t=e[h];let r;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=X(e,t.scope_.immer_.useStrictShallowCopy_)}else r=X(e,!0);return D(r,(n,c)=>{_e(r,n,ge(c))}),t&&(t.finalized_=!1),r}var _=new $e,F=_.produce;_.produceWithPatches.bind(_);_.setAutoFreeze.bind(_);_.setUseStrictShallowCopy.bind(_);_.applyPatches.bind(_);_.createDraft.bind(_);_.finishDraft.bind(_);function rt(){var re;const{t:e}=Se(),r=((re=ze().state)==null?void 0:re.purchaseId)||null,{extendedPurchase:n,setExtendedPurchase:c}=x.exports.useContext(Ae),{data:a,isPending:u}=Oe({queryKey:["purchases",{status:ie.inCart}],queryFn:()=>O.getPurchases({status:ie.inCart})}),f=a==null?void 0:a.data.data,y=W({mutationFn:O.updatePurchase,onSuccess:()=>{c(i=>{const s=U.exports.keyBy(i,"_id");return i.map(l=>{var m;return{...l,disabled:!1,checked:Boolean((m=s[l._id])==null?void 0:m.checked)}})||[]})}}),z=W({mutationFn:O.buyProducts,onSuccess:(i,s)=>{const l=s.map(m=>m.product_id);c(m=>m.filter(K=>!l.includes(K.product._id))),Ee.success(i.data.message,{position:"top-center",autoClose:1e3})}}),A=W({mutationFn:O.deletePurchase,onSuccess:(i,s)=>{c(l=>l.filter(m=>!s.includes(m._id)))}}),T=x.exports.useMemo(()=>n.every(i=>i.checked),[n]),g=x.exports.useMemo(()=>n.filter(i=>i.checked),[n]),te=g.length,xe=x.exports.useMemo(()=>g.reduce((i,s)=>i+s.product.price*s.buy_count,0),[g]),be=x.exports.useMemo(()=>g.reduce((i,s)=>i+(s.product.price_before_discount-s.product.price)*s.buy_count,0),[g]);x.exports.useEffect(()=>{f&&c(i=>{const s=U.exports.keyBy(i,"_id");return f.map(l=>{var m;return{...l,disabled:!1,checked:l._id===r||Boolean((m=s[l._id])==null?void 0:m.checked)}})})},[f,r]);const Pe=i=>s=>{c(F(l=>{l[i].checked=s.target.checked}))},q=()=>{c(i=>i.map(s=>({...s,checked:!T})))},ve=i=>s=>{c(F(l=>{l[i].buy_count=Number(s)}))},Q=(i,s,l)=>{if(l){const m=n[i];c(F(K=>{K[i].buy_count=s})),Ne(m,i,s)}},Ne=x.exports.useCallback(U.exports.debounce((i,s,l)=>{c(F(m=>{m[s].disabled=!0})),y.mutate({product_id:i.product._id,buy_count:l})},1e3),[]),we=i=>()=>{const s=n[i]._id;A.mutate([s])},ke=()=>{const i=g.map(s=>s._id);A.mutate(i)},Ce=()=>{if(g.length>0){const i=g.map(s=>({product_id:s.product._id,buy_count:s.buy_count}));z.mutate(i)}};return d("div",{className:"bg-neutral-100 py-16",children:[d(Fe,{children:[d("title",{children:[e("shopping cart")," | Shopee Clone"]}),o("meta",{name:"description",content:"Gi\u1ECF h\xE0ng c\u1EE7a b\u1EA1n"})]}),d("div",{className:"container",children:[o("div",{className:"overflow-auto",children:d("div",{className:"min-w-[1000px]",children:[d("div",{className:"grid grid-cols-12 rounded-sm bg-white py-5 px-9 text-sm capitalize text-gray-500 shadow",children:[o("div",{className:"col-span-6",children:d("div",{className:"flex items-center",children:[o("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:o("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:T,onChange:q})}),o("div",{className:"flex-grow text-black",children:e("product")})]})}),o("div",{className:"col-span-6",children:d("div",{className:"grid grid-cols-5 text-center",children:[o("div",{className:"col-span-2",children:e("unit price")}),o("div",{className:"col-span-1",children:e("quantity")}),o("div",{className:"col-span-1",children:e("total price")}),o("div",{className:"col-span-1",children:e("actions")})]})})]}),d("div",{className:"my-3 rounded-sm bg-white p-5 shadow",children:[u&&Array(5).fill(0).map((i,s)=>o(Be,{},s)),n.length>0&&n.map((i,s)=>d("div",{className:"mb-5 grid grid-cols-12 items-center rounded-sm border border-gray-200 bg-white py-5 px-4 text-center text-sm text-gray-500 first:mt-0",children:[o("div",{className:"col-span-6",children:d("div",{className:"flex",children:[o("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:o("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:i.checked,onChange:Pe(s)})}),o("div",{className:"flex-grow",children:d("div",{className:"flex",children:[o(ne,{className:"h-20 w-20 flex-shrink-0",to:ce({name:i.product.name,id:i.product._id}),children:o("img",{alt:i.product.name,src:i.product.image})}),o("div",{className:"flex flex-grow items-center px-2 pt-1 pb-2",children:o(ne,{to:ce({name:i.product.name,id:i.product._id}),className:"text-left line-clamp-2",children:i.product.name})})]})})]})}),o("div",{className:"col-span-6",children:d("div",{className:"grid grid-cols-5 items-center",children:[o("div",{className:"col-span-2",children:d("div",{className:"flex items-center justify-center",children:[d("span",{className:"text-gray-300 line-through",children:["\u20AB",k(i.product.price_before_discount)]}),d("span",{className:"ml-3",children:["\u20AB",k(i.product.price)]})]})}),o("div",{className:"col-span-1",children:o(je,{max:i.product.quantity,value:i.buy_count,classNameWrapper:"",onIncrease:l=>Q(s,l,l<=i.product.quantity),onDecrease:l=>Q(s,l,l>=1),onType:ve(s),onFocusOut:l=>Q(s,l,l>=1&&l<=i.product.quantity&&l!==n[s].buy_count),disabled:i.disabled})}),o("div",{className:"col-span-1",children:d("span",{className:"text-orange",children:["\u20AB",k(i.product.price*(i.buy_count||0))]})}),o("div",{className:"col-span-1",children:o("button",{className:"bg-none text-black transition-colors hover:text-orange",onClick:we(s),children:e("delete")})})]})})]},i._id))]}),n.length==0&&d("div",{className:"mt-[15px] flex h-[300px] flex-col items-center justify-center bg-white p-2",children:[o("img",{src:De,alt:"no purchase",className:"h-[160px] w-[160px]"}),o("div",{className:"mt-3 capitalize",children:e("no product")})]})]})}),d("div",{className:"sticky bottom-0 z-10 mt-8 flex flex-col rounded-sm border border-gray-100 bg-white p-5 shadow sm:flex-row sm:items-center",children:[d("div",{className:"flex items-center",children:[o("div",{className:"flex flex-shrink-0 items-center justify-center pr-3",children:o("input",{type:"checkbox",className:"h-5 w-5 accent-orange",checked:T,onChange:q})}),d("button",{className:"mx-3 border-none bg-none",onClick:q,children:[e("select all")," (",n.length,")"]}),o("button",{className:"mx-3 border-none bg-none",onClick:ke,children:e("delete")})]}),d("div",{className:"mt-5 flex flex-col sm:ml-auto sm:mt-0 sm:flex-row sm:items-center",children:[d("div",{children:[d("div",{className:"flex items-center sm:justify-end",children:[d("div",{children:[e("total pay")," (",te," ",te>1?e("items"):e("item"),"):"]}),d("div",{className:"ml-2 text-2xl text-orange",children:["\u20AB",k(xe)]})]}),d("div",{className:"flex items-center text-sm sm:justify-end",children:[o("div",{className:"text-gray-500",children:e("saved")}),d("div",{className:"ml-6 text-orange",children:["\u20AB",k(be)]})]})]}),o(Me,{className:"mt-5 flex h-10 w-52 items-center justify-center bg-red-500 text-sm uppercase text-white hover:bg-red-600 sm:ml-4 sm:mt-0",onClick:Ce,disabled:z.isPending,children:e("check out")})]})]})]})]})}export{rt as default};
